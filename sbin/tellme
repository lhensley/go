#!/bin/bash
# tellme

# Include script setup file
	source script-setup
    source _functions-staging
	if [ ! $FUNCTIONS_ARE_DEFINED ]; then echo $0: Functions not defined. Aborting; logger $0: Functions not defined. Aborting; exit 1; fi
	if [ ! $VARIABLES_ARE_DEFINED ]; then echo $0: Variables not defined. Aborting; logger $0: Variables not defined. Aborting; exit 1; fi

# Define UUID stuff
	THIS_TEMP_FILE="/tmp$0 - $(uuidgen)"
	mkdir -p $(dirname "$THIS_TEMP_FILE")
	touch "$THIS_TEMP_FILE"

# Compose the message
	echo $THIS_TEMP_FILE                                   >  "$THIS_TEMP_FILE" 2>&1
    cat /var/log/syslog | grep dvr             | grep bash >> "$THIS_TEMP_FILE" 2>&1
    cat /var/log/syslog | grep lgh             | grep bash >> "$THIS_TEMP_FILE" 2>&1
    cat /var/log/syslog | grep plexmediaserver | grep bash >> "$THIS_TEMP_FILE" 2>&1
    cat /var/log/syslog | grep mysql           | grep bash >> "$THIS_TEMP_FILE" 2>&1
    cat /var/log/syslog | grep postfix         | grep bash >> "$THIS_TEMP_FILE" 2>&1
	cat /home/lhensley/.cold*                              >> "$THIS_TEMP_FILE" 2>&1
	ps -ef |            | grep dvr                         >> "$THIS_TEMP_FILE" 2>&1
	ps -ef |            | grep lgh                         >> "$THIS_TEMP_FILE" 2>&1
	df -Ht ext4 >> "$THIS_TEMP_FILE" 2>&1

# Send the message
    cat "$THIS_TEMP_FILE"
	echo $(cat "$THIS_TEMP_FILE") | mail lhensley
	unlink "$THIS_TEMP_FILE"
	f_beep

# Include script footer file
	f_debug_variable "script_footer" "${PATHNAME[script_footer]}"
	source "${PATHNAME[script_footer]}"

exit 0
