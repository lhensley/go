#!/bin/bash
# process_ts
# Usage: process_ts <input_file> <root_work_path> <root_storage_path>
# No final / on either path. For system root, use ""

OUT_EXT="m4v"

IN_PATH=$1
ROOT_WORK_PATH=$2
ROOT_STORAGE_PATH=$3

ROOT_WORK_PATH_LENGTH=${#ROOT_WORK_PATH}

IN_PATH_LENGTH=${#IN_PATH}
IN_EXT="${IN_PATH##*.}"
IN_EXT_LENGTH="${#IN_EXT}"

RELATIVE_PATH_LENGTH=$[IN_PATH_LENGTH-ROOT_WORK_PATH_LENGTH-1]
RELATIVE_PATH=${IN_PATH: -$RELATIVE_PATH_LENGTH} # First remove ROOT_WORK_PATH
RELATIVE_PATH_LENGTH=$[RELATIVE_PATH_LENGTH-IN_EXT_LENGTH-1] # Recalculate relative path length by removing extension length
RELATIVE_PATH=${RELATIVE_PATH:0:RELATIVE_PATH_LENGTH} # Then remove IN_EXT

OUT_PATH=$ROOT_WORK_PATH/$RELATIVE_PATH/.$IN_EXT
STORE_PATH=$ROOT_STORAGE_PATH/$RELATIVE_PATH/.$IN_EXT

# So here are useful variables defined ...
# $IN_PATH
# $OUT_PATH
# $STORE_PATH
# $ROOT_WORK_PATH
# $ROOT_STORAGE_PATH
# $RELATIVE_PATH

# # This section is for testing only. Normally, just comment it out.
echo "IN_PATH:     @$IN_PATH@"
echo "OUT_PATH:    @$OUT_PATH@"
echo "STORE_PATH:  @$STORE_PATH_PATH@"
echo ""

exit 0